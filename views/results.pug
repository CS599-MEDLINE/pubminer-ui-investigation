//-
   results.pug

   Display the search results.

extends layout.pug
block scripts
    script(src="scripts/jquery.min.js")
    script(type="text/javascript").
        $(document).ready(function() {
            // Row Checkbox Selection
            $("input[type='checkbox']").change(function (e) {
              if ($(this).is(":checked")) {
                $(this).closest('.list-group-item').addClass("active");
              } else {
                $(this).closest('.list-group-item').removeClass("active");
              }
            });

            // click the list-view heading then expand a row
            $(".list-group-item-header").click(function(event){
              if(!$(event.target).is("button, a, input, .fa-ellipsis-v")){
                $(this).find(".fa-angle-right").toggleClass("fa-angle-down")
                .end().parent().toggleClass("list-view-pf-expand-active")
                .find(".list-group-item-container").toggleClass("hidden");

                if($(this).find(".fa-angle-down").length > 0) {
                    var eBody = $(this).closest("div.list-group-item").find("#expansionBody");
                    // Get the content from back end
                    $.get('/detail/' + $(this).find("#uid").val(), null, function(response) {
                        if (response.error) {
                            eBody.text(response.error);
                        } else {
                            eBody.html("");
                            for (var key in response) {
                                if (response.hasOwnProperty(key)) {
                                    eBody.append($("<strong>", {html: key}));
                                    eBody.append(" " + response[key]);
                                    eBody.append("<br/>")
                                }
                            }
                        }
                    });
                }
              } else {
              }
            })

            // click the close button, hide the expand row and remove the active status
            $(".list-group-item-container .close").on("click", function (){
              $(this).parent().addClass("hidden")
              .parent().removeClass("list-view-pf-expand-active")
              .find(".fa-angle-right").removeClass("fa-angle-down");
            })
        });
block content
    if results.items.length == 0
        p(style='margin: 24px 0px 0px 20px; font-style: italic;') No results found for "#{results.searchTerm}"
    else
        p(style='margin: 24px 0px 0px 20px; font-style: italic;') Displaying #{results.itemsReturned} of #{results.itemsFound} results found for "#{results.searchTerm}"
        div(class='container-fluid')
            div(class='list-group list-view-pf list-view-pf-view')
                each item in results.items
                    div(class='list-group-item')
                        div(class="list-group-item-header")
                            div(class="list-view-pf-expand")
                                span(class="fa fa-angle-right")
                            div(class="list-view-pf-checkbox")
                                input(type="checkbox")
                            div(class="list-view-pf-main-info")
                                div(class="list-group-item-heading")
                                    a(target="_blank" href=`https://www.ncbi.nlm.nih.gov/pmc/articles/PMC${item.uid}`) #{item.uid}
                                    input(type="hidden" id="uid" value=`${item.uid}`)
                                    each articleid in item.articleids
                                        if articleid.idtype == "pmid"
                                            br
                                            a(target="_blank" href=`https://www.ncbi.nlm.nih.gov/pubmed/${articleid.value}`) #{articleid.value}
                            div(class="list-view-pf-body")
                                    div(class="list-view-pf-description")
                                        div(class="list-group-item-text")
                                            span
                                                strong= item.title
                                            br
                                            - var displayComma = false
                                            each author, index in item.authors
                                                if author.authtype == "Author"
                                                    if displayComma == true
                                                        span ,&nbsp;
                                                    span= author.name
                                                    - displayComma = true
                                    div(class="list-view-pf-additional-info")
                                        div(class="list-view-pf-additional-info-item")
                                            span(class="pficon pficon-screen")
                                            span Age 19-64
                                        div(class="list-view-pf-additional-info-item")
                                            span(class="pficon pficon-cluster")
                                            span Male 50%
                                        div(class="list-view-pf-additional-info-item")
                                            span(class="pficon pficon-container-node")
                                            span Female 50%
                                        div(class="list-view-pf-additional-info-item")
                                            span(class="pficon pficon-image")
                                            span Race: Other
                        div(class="list-group-item-container container-fluid hidden")
                            div(class="close")
                                span(class="pficon pficon-close")
                            div(id="expansionBody")
